<!doctype html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">  
    <title>Генератор заданий</title>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script>
    <script type="text/javascript" src="generator2.0.js"></script>
  	<link rel="stylesheet" type="text/css" href='style.css'>
</head>
<body>
	<div class=app>
		<div class=header>
			<div>
				<span>Значения</span>&nbsp;
				<input type='number' id='minInput' placeholder='От'>&nbsp;
				<input type='number' id='maxInput' placeholder='До'>&nbsp;
				<input type='number' id='fixedInput' placeholder='Точность'>
			</div>
			<div>
				<p style='text-align: center; margin:0;'>
				<select id='formatChoice'>
					<option value='3'>3 варианта на A4</option>
					<option value='5'>5 вариантов на A4</option>
					<option value='6'>6 вариантов на A4</option>
					<option value='10'>10 вариантов на A4</option>
				</select> &nbsp;
				<button id='generate'>На печать</button> &nbsp;
				<input type='checkbox' id='shuffleButton' name='Shuffle'><span>Перемешать</span> &nbsp; &nbsp; &nbsp;
				</p>
			</div>
		</div>
		<div class=input>
			<textarea class='textField' id='inputContainer'></textarea>
		</div>
		<div class='preview textField' id='previewContainer'></div>
		<div class=footer></div>
	</div>
	<div class='print textField' style="display:none" id=printContainer></div>
	<script>
		inputContainer = document.getElementById('inputContainer');
		previewContainer = document.getElementById('previewContainer');
		printContainer = document.getElementById('printContainer');
		minInput = document.getElementById('minInput');
		maxInput = document.getElementById('maxInput');
		fixedInput = document.getElementById('fixedInput');
		shuffleButton = document.getElementById('shuffleButton');
		generateButton = document.getElementById('generate');
		formatChoice = document.getElementById('formatChoice');

		variantHeight='210mm';
		
		getTask = function() {
			if (inputContainer.value!='') {
				pattern = inputContainer.value.split('\n');
				pattern = generator.generateSeries(pattern);
				pattern = pattern.map(el => '\\('+generator.generate(el)+'\\)');
				return pattern
			}
			else return [];
		}
		
		getPreview = function () {
			previewContainer.innerHTML='';
			task = getTask();
			task.forEach(el => previewContainer.innerHTML+=el+'<br>');
			MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
		}

		
		getPrint = function() {
			printContainer.innerHTML='';
			for (k=0;k<30;k++) {
				div=document.createElement('div');
				div.style.height=variantHeight;
				task = getTask();
				task.forEach(el => div.innerHTML+=el+'<br>');
				printContainer.appendChild(div);
			}
			MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
		}

		inputContainer.oninput = () => getPreview();
		
		minInput.onchange = () => {generator.min = parseInt(minInput.value); getPreview();}
		
		maxInput.onchange = () => {generator.max = parseInt(maxInput.value); getPreview();}
		
		fixedInput.onchange = () => {generator.round = parseInt(fixedInput.value); getPreview();}
		
		shuffleButton.onchange= () => {generator.shuffle=shuffleButton.checked; getPreview();}
		
		generateButton.onclick = () => {
			if ((printContainer.style.display=='none') && (inputContainer.value!='')) {
				getPrint();
				printContainer.style.display='grid';
				generateButton.innerText='Вернуться';
			}
			else {
				printContainer.style.display='none';
				generateButton.innerText='На печать';
			}
		}
		
		formatChoice.onchange = () => {
			option = formatChoice.options[formatChoice.selectedIndex].value;
			if (option==3) {printContainer.style.gridTemplateColumns='repeat(3,1fr)'; variantHeight='210mm';}
			else if (option==5) {printContainer.style.gridTemplateColumns='repeat(5,1fr)'; variantHeight='210mm';}
			else if (option==6) {printContainer.style.gridTemplateColumns='repeat(3,1fr)'; variantHeight='105mm';}
			else if(option==10) {printContainer.style.gridTemplateColumns='repeat(5,1fr)'; variantHeight='105mm';}
		}
	</script>
</body>
</html>